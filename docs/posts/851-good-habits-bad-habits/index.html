<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Wendy Wood">

<title>Good Habits, Bad Habits – Dan Yavorsky</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../custom.scss">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Dan Yavorsky</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pubs/index.html"> 
<span class="menu-text">Pubs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="http://dcms-r.danyavorsky.com" target="_blank"> 
<span class="menu-text">DCMS-R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../links/index.html"> 
<span class="menu-text">Links</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Good Habits, Bad Habits</h1>
                  <div>
        <div class="description">
          Wendy Wood
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1-how-we-really-are" id="toc-part-1-how-we-really-are" class="nav-link active" data-scroll-target="#part-1-how-we-really-are">Part 1: How We Really Are</a>
  <ul class="collapse">
  <li><a href="#persistence-and-change" id="toc-persistence-and-change" class="nav-link" data-scroll-target="#persistence-and-change">1. Persistence and Change</a></li>
  <li><a href="#the-depths-beneath" id="toc-the-depths-beneath" class="nav-link" data-scroll-target="#the-depths-beneath">2. The Depths Beneath</a></li>
  <li><a href="#introducing-your-second-self" id="toc-introducing-your-second-self" class="nav-link" data-scroll-target="#introducing-your-second-self">3. Introducing Your Second Self</a></li>
  <li><a href="#what-about-knowledge" id="toc-what-about-knowledge" class="nav-link" data-scroll-target="#what-about-knowledge">4. What About Knowledge?</a></li>
  <li><a href="#what-about-self-control" id="toc-what-about-self-control" class="nav-link" data-scroll-target="#what-about-self-control">5. What About Self-Control?</a></li>
  </ul></li>
  <li><a href="#part-2-the-three-bases-of-habit-formation" id="toc-part-2-the-three-bases-of-habit-formation" class="nav-link" data-scroll-target="#part-2-the-three-bases-of-habit-formation">Part 2: The Three Bases of Habit Formation</a>
  <ul class="collapse">
  <li><a href="#context" id="toc-context" class="nav-link" data-scroll-target="#context">6. Context</a></li>
  <li><a href="#repetition" id="toc-repetition" class="nav-link" data-scroll-target="#repetition">7. Repetition</a></li>
  <li><a href="#reward" id="toc-reward" class="nav-link" data-scroll-target="#reward">8. Reward</a></li>
  <li><a href="#consistency-is-for-closers" id="toc-consistency-is-for-closers" class="nav-link" data-scroll-target="#consistency-is-for-closers">9. Consistency Is for Closers</a></li>
  <li><a href="#total-control" id="toc-total-control" class="nav-link" data-scroll-target="#total-control">10. Total Control</a></li>
  </ul></li>
  <li><a href="#part-3-special-cases-big-opportunities-and-the-world-around-us" id="toc-part-3-special-cases-big-opportunities-and-the-world-around-us" class="nav-link" data-scroll-target="#part-3-special-cases-big-opportunities-and-the-world-around-us">Part 3: Special Cases, Big Opportunities, and the World Around Us</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="part-1-how-we-really-are" class="level2">
<h2 class="anchored" data-anchor-id="part-1-how-we-really-are">Part 1: How We Really Are</h2>
<section id="persistence-and-change" class="level3">
<h3 class="anchored" data-anchor-id="persistence-and-change">1. Persistence and Change</h3>
<ul>
<li>Intelligence and motivation have little to do with getting things done on a regular basis.</li>
<li>We are not one single unified whole.</li>
<li>Our minds are composed of multiple separate but interconnected mechanisms that guide behavior.</li>
<li>Executive control functions are thoughtful cognitive processes to select and monitor actions.</li>
<li>Skip the debate chamber and get to work. That’s exactly what habits are for.</li>
<li>We have little conscious experience of forming a habit or acting out of habit.</li>
<li>The purpose of this book it to show how we can use conscious understanding of our goals to orient our habitual selves.</li>
<li>For these one-off, occasional behaviors, conscious decisions ruled, and people with strong attitudes just did them.</li>
<li>With some behaviors, people’s attitudes and plans had little impact on how they acted.</li>
<li>People could consciously report strong attitudes and plans, but they continued their past actions regardless.</li>
<li>Persistence mostly did not reflect strong attitudes and plans.</li>
<li>We now know that it’s habit that creates persistence.</li>
<li><strong>This book explains what we have learned about how to create habits.</strong></li>
<li>This is desire’s ironic twist. Trying to suppress it undermines our best intentions and makes our goals harder to achieve. It confounds our good behavior by turning it into torture.</li>
<li>We are engaging in executive control, or top-down processing, by controlling our unwanted habits with our better intentions.</li>
<li>This is the way many of us live. Our conscious decision-making self is pitted against our habitual, automatic responses. We are wrenched over and over by bad habits, in a sort of internal war. But there is another way.</li>
<li>When our automatic response is the desired one, our habits and goals are in harmony. We no longer have to rely on will. <strong>This is the payoff to this book: understanding how to form good habits amid the pitfalls of daily life.</strong></li>
</ul>
</section>
<section id="the-depths-beneath" class="level3">
<h3 class="anchored" data-anchor-id="the-depths-beneath">2. The Depths Beneath</h3>
<ul>
<li>What actually are habits?</li>
<li>They are tricky to study because they are inherently unknowable to the person performing them.</li>
<li>Just being around people is enough to turn the spotlight inward and to start to monitor what you would normally do without much scrutiny at all. This is potentially useful if you ever feel like you just aren’t very aware of your habitual self (and would like to be). Go public. You’ll have a better sense of self in no time.</li>
<li>You can make pretty much any behavior more habitual, as long as you do it the same way each time.</li>
<li>Habit refers to <em>how</em> you perform an action, not <em>what</em> the action is.</li>
<li>The key feature of habit: it works outside of our conscious awareness.</li>
<li>Our curiosity about ourselves has already been satisfied by the belief that we do the things we do because we “will” them. It’s flattering and empowering, but it’s also false.</li>
<li>If our noisy, egotistical consciousness takes all of the credit for the actions of our silent habitual self, we’ll never learn how to properly exploit this hidden resource.</li>
</ul>
</section>
<section id="introducing-your-second-self" class="level3">
<h3 class="anchored" data-anchor-id="introducing-your-second-self">3. Introducing Your Second Self</h3>
<ul>
<li>Habits are a kind of action that is relatively <em>insensitive</em> to rewards.</li>
<li>Rewards are important when you first do something.</li>
<li>That’s just step one.</li>
<li>Our responses are no longer aimed at seeking outcomes; instead they are triggered automatically by the performance context.</li>
<li>For habitual runners, running was triggered quickly when first cued by the places they tipically run… Goals seemed important for the occasional runners.</li>
<li>Goals and rewards, it seems, are critical for starting to do something repeatedly. They are what lead us to form many beneficial habits in the first place.</li>
<li>A working definition of habit emerged: a <em>mental association between a context cue and a response that develops as we repeat an action in that context for a reward</em> (mature habits can operate without the ongoing presence of a reward).</li>
<li>But a shorthand definition is this: <em>automaticity in lieu of conscious motivation</em>.</li>
<li>It’s not picky about what it learns. Give it repetition, rewards, and contexts.</li>
<li>Procedural memory: it’s such an important repository of information that only the most frequently repeated patterns get stored like this.</li>
<li>Other habits are almost as sticky… they fade only slowly as you fail to use them.</li>
<li>Firefighters and football players (in the examples) both apparently identify a cue and have learned, through extensive practice, the right response.</li>
</ul>
</section>
<section id="what-about-knowledge" class="level3">
<h3 class="anchored" data-anchor-id="what-about-knowledge">4. What About Knowledge?</h3>
<ul>
<li>Their intentions were no match for their habits. Another way to say this is: we often don’t realize what our habits are doing.</li>
<li>The parts of our lives that haven’t been claimed by our habitual self are indeed still receptive to our will – and receptive to new habit formation.</li>
<li>With enough practice, all can learn habit associations between contexts and the rewarded response.</li>
<li>In humans, habit learning isn’t superseded or subordinated by more thoughtful learning systems.</li>
<li>The default-interventionist system: The idea is that we’re using the default mode of autopilot most of the time, unless there’s a good enough reason to intervene with conscious thought.</li>
</ul>
</section>
<section id="what-about-self-control" class="level3">
<h3 class="anchored" data-anchor-id="what-about-self-control">5. What About Self-Control?</h3>
<ul>
<li>Importance of situations.</li>
<li>Participants who scored highest in self-control seldom reported resisting desires, period. They just didn’t experience many unwanted desires in the first place.</li>
<li>People high in self control are not living a life full of self-denial and deprivation. Somehow they are managing their lives better.</li>
<li>But once they get started, they don’t think much about stopping or whether they are uncomfortable. They have a set pattern, and they follow it. They are not making decisions.</li>
<li>Here’s the very happy implication: the worst, most effortful run will be that first one. Or the second, perhaps.</li>
<li>High self-controllers achieved desired outcomes by streamlining, not struggling.</li>
<li>Researchers anticipated that high self-controllers would especially shine at difficult tasks that required the central executive. After all, this is what, until recently, we though the self-control scale measures – sheer force of will. But even in these more controlled studies, the data did not support this idea. Instead, high self-control people performed better at the more habitual, automatic tasks than low self-control ones. High self-controllers were simply proficient at automating.</li>
<li>People who score high in self-control seem to be doing nothing that the scale was ever designed to assess. They do not experience many unwanted desires, almost as if they had neutralized the temptations in their environments. They also know how to form habits by repeating the same things at the same times and in the same places.</li>
<li>Habits that enable them to reliably meet goals without much struggle.</li>
<li>Self-control is simple when you understand that it involves putting yourself in the right situations to develop the right habits.</li>
<li>A habit happens when a context cue is sufficiently associated with a rewarded response to become automatic.</li>
</ul>
</section>
</section>
<section id="part-2-the-three-bases-of-habit-formation" class="level2">
<h2 class="anchored" data-anchor-id="part-2-the-three-bases-of-habit-formation">Part 2: The Three Bases of Habit Formation</h2>
<section id="context" class="level3">
<h3 class="anchored" data-anchor-id="context">6. Context</h3>
<ul>
<li>Once the environment changed, so did the habit.</li>
<li>Some of the pressures that act on us come from inside ourselves, in the from of our goals, feelings, and attitudes. For Lewin, the contexts we are in (which he called “environments”) also generated forces on our behavior.</li>
<li>Restraining forces are like a kind of friction.</li>
<li>Marketing: a driving force, designed to reduce friction.</li>
<li>We can use driving and restraining forces to our advantage.</li>
<li>There is perhaps no simpler context influence we can engineer in our lives than sheer proximity. Proximity determines the external forces to which we are exposed. We engage with what is near us and tend to overlook what is farther away.</li>
<li>What did you do last time you tried to change your behavior? Probably you thought about what you were doing wrong and why you wanted to change it. You focused on your desire to be successful. You acted as if your desires were in charge.</li>
<li>A belief in free will has many advantages. But is also leads us to overlook the powerful influence of the physical and social worlds we inhabit. Our strong intentions blind us to the friction in our everyday surroundings.</li>
<li>We underestimate the impact of our environments.</li>
<li>We tend to overlook the influence of our surroundings, even as we are responding to them in our behavior and self-assessments. No surprise, then, that when we try to change, our go-to approach is will-power and motivation. We don’t realize how much our actions are driven by our surroundings and the pressures on us. But our habits do.</li>
<li>Address the context.</li>
</ul>
</section>
<section id="repetition" class="level3">
<h3 class="anchored" data-anchor-id="repetition">7. Repetition</h3>
<ul>
<li>You’ve arranged your context. You’ve recognized the restraining forces, the driving forces, and the pitfalls of your introspection illusion. You’ve turned your life into a clearinghouse for good… so when does the magic happen? There are a couple more critical ingredients.</li>
<li>At first, it feels exciting. You’re proud of your new sense of responsibility.</li>
<li>The first time, it’s hard work.</li>
<li>The truth is, it’s impossible to know.</li>
<li>You’re going to keep doing it… until <em>you</em> aren’t doing it anymore.</li>
<li>The magic begins silently, and you won’t realize when it kicks in. You have to trust that it will happen.</li>
<li>Until we have laid down a habit in neural networks and memory systems, we must willfully decide to repeat a new action again and again, even when it’s a struggle. At some point, it becomes second nature, and we can sit back and let autopilot drive.</li>
<li>A new action is difficult to sustain when the <em>only</em> driving forces are internal motivators.</li>
<li>This is the crucial point. You can miss a day or two and you will not be back to zero.</li>
<li>On average, it took participants 66 days of repeating a simple health behavior until they experienced it as automatic.</li>
<li>An implication is that you can lower your magic number by establishing forces that push you to repeat in the same way each time. With bigger, louder cues, your habit potentially matures faster.</li>
<li>A wholesome new habit has to reckon with something else, though. Very little of our lives is a black space.</li>
<li>Along with the challenges of adopting new behaviors, you still have to fight off the old ones.</li>
<li>This is where repetition of the new action becomes especially useful as a tool (and not just an inert description of what habits look like).</li>
<li>Repetition, then, should be thought of not as some kind of magical primer for habits, but rather as a way to induce speedy mental action.</li>
<li>Speed isn’t the only factor at work. It goes hand in hand with another consequence of repetition: streamlined decision-making. We stop considering alternative actions.</li>
<li>Habits come from repetition. Behavior begets behavior. There isn’t a further, more complicated, rare, or special ingredient. That should be wonderfully liberating. That should make you optimistic. If you just <em>keep</em> doing it, it’ll start happening with more and more ease.</li>
<li>Excellence and repetition are not the same.</li>
<li>We all know that repetition is <em>necessary</em> to excel, but it’s less clear that it’s <em>sufficient</em>.</li>
<li>With more practice, people did better at games, music, and sports, but sill 75 percent or more of their success or failure was due to factors such as native talent, opportunity, and having great trainers.</li>
</ul>
</section>
<section id="reward" class="level3">
<h3 class="anchored" data-anchor-id="reward">8. Reward</h3>
<ul>
<li>Context will smooth the way, and repetition will jump-start the engine, but if you aren’t getting even a minor <em>reward</em> for your initial effort along the way, you won’t get that habit to start operating on its own.</li>
<li>Rewards, to have a role in habit formation, have to be bigger and better than what you would normally experience.</li>
<li>Reward prediction error: In the brain, unexpected rewards spur the release of dopamine.</li>
<li>It then sets up the neural bases for habit formation, as neurons, synapses, and pathways work together to record and respond to what just happened.</li>
<li>Dopamine seems to promote habit learning for less than a minute.</li>
<li>Rewards have to be experienced right after we do something in order to build habit associations (context-response) in memory.</li>
<li>Given this timing, the most effective habit-building rewards are often <em>intrinsic</em>, or part of the action itself.</li>
<li>Students who did not experience the rewards that create automaticity from repetition had to keep consciously making themselves get to the track or gym, without a helpful habit taking over.</li>
<li>They are too far removed from the behavior you are trying to change, and they are not necessarily tied to any specific repetition. Given the way that dopamine works to create habit associations in memory, immediate rewards for lots of repetitions are key.</li>
<li>There’s more to the dopamine story and immediacy. As we discussed, dopamine responds to uncertainty in the form of reward prediction errors, which enable us to learn from the experience. This means that we learn from unusual or unexpected rewards.</li>
<li>Habits depend on surprise; uncertain rewards matter most.</li>
<li>For scientists, insensitivity to reward is the gold standard for identifying a habit. The only way to know for sure if an action is habitual is to test what happens when the reward changes. If we persist even when we don’t value the reward as much or it’s no longer as available, then it’s a habit.</li>
</ul>
</section>
<section id="consistency-is-for-closers" class="level3">
<h3 class="anchored" data-anchor-id="consistency-is-for-closers">9. Consistency Is for Closers</h3>
<ul>
<li>Habits, as we have seen, thrive on reward uncertainty. Beyond this, habits don’t crave variety. In fact, they hate it. Variety weakens habit. This is because variety is the enemy of stable contexts, which, as we have learned, are the <em>sine qua non</em> of habits.</li>
<li>In this chapter, we’re going to learn how important it is to keep your habit-promoting context as stable as possible.</li>
<li>These studies are good illustrations that “context” definitely does not just mean “physical environment.” Location is important, but your context can also consist of intangible things: the time of day, for instance, or your state of mind. One of your most important possible contexts is other people.</li>
<li>Forming habits, it seems, is about establishing stable cues that support your desired actions.</li>
</ul>
</section>
<section id="total-control" class="level3">
<h3 class="anchored" data-anchor-id="total-control">10. Total Control</h3>
<ul>
<li><em>Mise en place</em> is French for “put in place.”</li>
<li>“Harnessing friction” offers a whole new way to think about changing behavior. The promise is that, by altering contexts that create friction in our lives, we can learn to automatically repeat rewarding actions. But first, we have to identify these contexts. And they are not always obvious.</li>
<li>If this sounds like a lot of work for your executive, conscious mind, you’re absolutely right.</li>
<li>The greatest source of friction in this world is other people. They are both helpful and detrimental forces on our desired selves.</li>
<li>If you leave this book with one word and one idea, I hope it’s friction. It is simple and intuitive, and can be manipulated to help accomplish astounding things.</li>
<li>Habits are more likely to form when we act repeatedly without planning and deliberating.</li>
</ul>
</section>
</section>
<section id="part-3-special-cases-big-opportunities-and-the-world-around-us" class="level2">
<h2 class="anchored" data-anchor-id="part-3-special-cases-big-opportunities-and-the-world-around-us">Part 3: Special Cases, Big Opportunities, and the World Around Us</h2>
<p>Omitted from this summary</p>
<ul>
<li><ol start="11" type="1">
<li>Jump Through Windows</li>
</ol></li>
<li><ol start="12" type="1">
<li>The Special Resilience of Habit</li>
</ol></li>
<li><ol start="13" type="1">
<li>Contexts of Addiction</li>
</ol></li>
<li><ol start="14" type="1">
<li>Happy with Habit</li>
</ol></li>
<li><ol start="15" type="1">
<li>You Are Not Alone</li>
</ol></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.danyavorsky\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>