<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Johann Hari">

<title>Dan Yavorsky - Stolen Focus: Why You Can’t Pay Attention and How to Think Deeply Again</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Dan Yavorsky</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching/index.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../pubs/index.html"> 
<span class="menu-text">Pubs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts/index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../dcms-r.danyavorsky.com"> 
<span class="menu-text">R-DCMS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../links/index.html"> 
<span class="menu-text">Links</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Stolen Focus: Why You Can’t Pay Attention and How to Think Deeply Again</h1>
                  <div>
        <div class="description">
          Johann Hari
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="ch0-introduction" class="level4">
<h4 class="anchored" data-anchor-id="ch0-introduction">Ch0: Introduction</h4>
<ul>
<li><p>Fifty years ago there was very little obesity, but today it is endemic in the Western world. This is not because we suddenly became greedy or self-indulgent. He said: “Obesity is not a medical epidemic – it’s a social epidemic.” (p11)</p></li>
<li><p>I found strong evidence that our collapsing ability to pay attention is not primarily a personal failing on my part, or your part, or you kid’s part. This is being done to us all. It is being done by very powerful forces. …there are twelve deep forces at work that are damaging our attention. (p12)</p></li>
<li><p>There are real steps you can take as an isolated individual to reduce this problem for yourself… But I have to be honest with you, in a way that I fear previous book on this topic were not. Those changes will only get you so far. … Systemic problems require systemic solutions. (p12)</p></li>
</ul>
</section>
<section id="ch1-the-increase-in-speed-switching-and-filtering" class="level4">
<h4 class="anchored" data-anchor-id="ch1-the-increase-in-speed-switching-and-filtering">Ch1: The Increase in Speed, Switching, and Filtering</h4>
<ul>
<li>So if you spend your time switching a lot, then the evidence suggests you will be slower, you’ll make more mistakes, you’ll be less creative, and you’ll remember less of what you do. (p40)</li>
</ul>
</section>
<section id="ch2-the-crippling-of-our-flow-states" class="level4">
<h4 class="anchored" data-anchor-id="ch2-the-crippling-of-our-flow-states">Ch2: The Crippling of Our Flow States</h4>
<ul>
<li><p>He called it a “flow state.” This is when you are so absorbed in what you are doing that you lose all sense of yourself, and time seems to fall away, and you are flowing into the experience itself. It is the deepest for of focus and attention that we know of. (p55)</p></li>
<li><p>Relaxing rarely gets you into a flow state (p55)</p></li>
<li><p>Three core components: (1) choose a clearly defined goal, … (2) that’s meaningful, and … (3) that’s at the edge of your abilities. (p55-56)</p></li>
<li><p>So, to find flow, you need to chose one single goal; make sure your goal is meaningful to you; and try to push yourself to the edge of your abilities. (p56)</p></li>
<li><p>To recover from our loss of attention, it is not enough to strip out our distractions. That will just create a void. We need to strip out our distractions and to replace them with sources of flow. (p60)</p></li>
</ul>
</section>
<section id="ch3-the-rise-of-physical-and-mental-exhaustion" class="level4">
<h4 class="anchored" data-anchor-id="ch3-the-rise-of-physical-and-mental-exhaustion">Ch3: The Rise of Physical and Mental Exhaustion</h4>
<ul>
<li><p>When people are kept awake, “one of the first things to go is the ability to focus our attention.” (p66)</p></li>
<li><p>Today 40 percent of Americans are chronically speel-deprived, getting less than the necessary minimum of seven hours of sleep per night. … Only 15 percent of us wake up from our sleep feeling refreshed. This is new. Since 1942, the average amount of time a person sleeps has been slashed by an hour a night. (p66)</p></li>
<li><p>“You can deprive yourself of sleep and live. We could never raise children if we couldn’t drop down on our sleep, right? We’d never survive hurricanes. You can do that – but it comes at a cost. The cost is [that] your body shifts into the sympathetic nervous system zone – so your body is like, ’Uh-oh, you’re depriving yourself of sleep, must be an emergency.” (p69)</p></li>
<li><p>The less you sleep, the more the world blurs in every way – in your immediate focus, in your ability to think deeply and make connections, and in your memory. (p70)</p></li>
<li><p>We live in an apparent paradox. Many of the things we need to do are so obvious they are banal; slow down, do one thing at a time, sleep more. But even though at some level we all know them to be true, we are in fact moving in the opposite direction: toward more speed, more switching, less sleep. We live in a gap between what we know we should do and what we feel we can do. (p77-78)</p></li>
</ul>
</section>
<section id="ch4-the-collapse-of-sustained-reading" class="level4">
<h4 class="anchored" data-anchor-id="ch4-the-collapse-of-sustained-reading">Ch4: The Collapse of Sustained Reading</h4>
<ul>
<li><p>The medium is the message … The way information gets to you is more important than the information itself. (p83)</p></li>
<li><p>I like the person I become when I read a lot of books. I dislike the person I become when I spend a lot of time on social media. (p86)</p></li>
</ul>
</section>
<section id="ch5-the-disruption-of-mind-wandering" class="level4">
<h4 class="anchored" data-anchor-id="ch5-the-disruption-of-mind-wandering">Ch5: The Disruption of Mind-Wandering</h4>
<ul>
<li><p>Mind wandering … you are slowly making sense of the world. (p95)</p></li>
<li><p>When your mind wanders, it starts to make new connections between things, (p96)</p></li>
<li><p>To be productive, you can’t aim simply to narrow your spotlight as much as possible (p97)</p></li>
<li><p>Mind-wandering can easily descent into rumination. … In situations of low stress and safety, mind-wandernig will be a gift, a pleasure, a creative force. In situations of high stress or danger, mind-wandering will be a torment. (p100)</p></li>
</ul>
</section>
<section id="ch6-7-the-rise-of-technology-that-can-track-and-manipulate-you" class="level4">
<h4 class="anchored" data-anchor-id="ch6-7-the-rise-of-technology-that-can-track-and-manipulate-you">Ch6-7: The Rise of Technology That Can Track and Manipulate You</h4>
<ul>
<li><p>Inside of Facebook’s servers, inside of Google’s servers, there is a little voodoo doll, [and it is] a model of you. It starts by not looking much like you. … They’re reassembling all that metadata you don’t really think is meaningful, so that doll looks more and more like you. (p126)</p></li>
<li><p>Whenever something is provided by a tech company for free, it’s always to improve the voodoo doll. Surveillance capitalism. (p127)</p></li>
<li><p>For years, I had blamed my deteriorating powers of attention simply on my own failings or on the existence of the smartphone itself as technology. … Tristan taught me that the phones we have, and the programs that run on them, were deliberately designed by the smartest people in the world to maximally hold our attention. (p128)</p></li>
<li><p>Unfortunately, there’s a quirk of human behavior. On average, we will stare at something negative and outrageous for a lot longer than we will stare at something positive and calm. … It’s called “negativity bias.” (p131)</p></li>
<li><p>So an algorithm that prioritizes keeping you glued to the screen will – unintentionally but inevitably – prioritize outraging and angering you. If it’s more enraging, it’s more engaging. (p131)</p></li>
<li><p>First, these sites and apps are designed to train our minds to crave frequent rewards. … Once you have been conditioned to need these reinforcements, it’s very hard to be with reality, the physical world, the built world – because it doesn’t offer as frequent and as immediate rewards as this thing does. (p133)</p></li>
<li><p>We don’t just pay attention as individuals; we pay attention together, as a society. (p134)</p></li>
<li><p>Over time, you expose any country to all this for long enough, it will become a country so lost in rage and unreality that it can’t make sense of it’s problems and it can’t build solutions. (p140)</p></li>
</ul>
</section>
<section id="ch7-the-rise-of-cruel-optimism" class="level4">
<h4 class="anchored" data-anchor-id="ch7-the-rise-of-cruel-optimism">Ch7: The Rise of Cruel Optimism</h4>
<ul>
<li><p>If we are going to overcome this process of becoming hooked on our apps and devices, we have to develop individual skills to resist the part inside all of us that succumbs to these distractions. He argues that to do that, we primarily have to look inward – to the reasons why we want to use them compulsively in the first place. … It’s not your fault. I never said it’s your fault. It’s your responsibility. (p144-145)</p></li>
<li><p>An internal trigger is an uncomfortable emotional state. … It’s all about avoidance. … He believes we all need to explore our triggers nonjudgmentally, think about them, and find ways to disrupt them. (p145)</p></li>
<li><p>Two-things of people with a smartphone never change their notification settings. What? Right? This is not hard stuff. (P146)</p></li>
<li><p>How many of us plan our day? Actually what do I want to do with my time? (p147)</p></li>
<li><p>Cruel Optimism: this is when you take a really big problem with deep causes in our culture – like obesity, or depression, or addiction – and you offer people, in upbeat language, a simplistic individual solution. (p150)</p></li>
<li><p>While at first glance, cruel optimism seems kind and optimistic, it often has an ugle aftereffect. It ensures that when the small, cramped solution fails, as it will most of the time, the individual won’t blame the system – she will blame herself. It whispers: the problem isn’t in the system; the problem is in you. (p151)</p></li>
</ul>
</section>
<section id="ch9-the-first-glimpse-of-the-deeper-solution" class="level4">
<h4 class="anchored" data-anchor-id="ch9-the-first-glimpse-of-the-deeper-solution">Ch9: The First Glimpse of the Deeper Solution</h4>
<ul>
<li>The business model can only be changed by regulation imposed on these companies by governments. (p161)</li>
</ul>
</section>
<section id="ch10-the-surge-in-stress-and-how-it-is-triggering-vigilance" class="level4">
<h4 class="anchored" data-anchor-id="ch10-the-surge-in-stress-and-how-it-is-triggering-vigilance">Ch10: The Surge in Stress and How It Is Triggering Vigilance</h4>
<ul>
<li><p>These technologies arrived in our lives at a moment when we were unusually vulnerable to them. (p171)</p></li>
<li><p>Top reasons attention is getting worse: stress, change in life circumstances, difficult or disturbed sleep, phones. (p172)</p></li>
<li><p>To pay attention in normal ways, you need to feel safe (p177)</p></li>
</ul>
</section>
<section id="ch11-the-places-that-figures-out-how-to-reverse-the-surge-in-speed-and-exhaustion" class="level4">
<h4 class="anchored" data-anchor-id="ch11-the-places-that-figures-out-how-to-reverse-the-surge-in-speed-and-exhaustion">Ch11: The Places that Figures Out How to Reverse the Surge in Speed and Exhaustion</h4>
<ul>
<li><p>When people work less, their focus significantly improves. (p190)</p></li>
<li><p>We live in a culture that gest us to walk faster, talk faster, work longer, and we are taught to think that is where productivity and success come from. (P190)</p></li>
<li><p>But Covid also showed us something else that is relevant to a four-day week. It demonstrated that businesses can change their working practices radically, in a very short period of time, and continue to fuction well. (p193)</p></li>
<li><p>The way we work seems fixed and unchangeable – until it changes, and then we realize it didn’t have to be like that in first place. (p193)</p></li>
</ul>
</section>
<section id="ch12-our-deteriorating-diets-and-rising-pollution" class="level4">
<h4 class="anchored" data-anchor-id="ch12-our-deteriorating-diets-and-rising-pollution">Ch12: Our Deteriorating Diets and Rising Pollution</h4>
<ul>
<li><p>Yet every day, all over the Western world, we are putting into our bodies substances “which are so far removed from what was intended for human fuel.” Achieving sustained attention, is a physical process that requires your body to able to do certain things. So if you disrupt your body – by depriving it of the nutrients it needs, or by pumping it full of pollutants – your ability to pay attention will also be disrupted. (p197-198)</p></li>
<li><p>Three broad ways in which how w2e eat now is harming our focus: (1) we currently eat a diet that causes regular energy spikes and energy crashes, (2) most of us now eat in a way that deprives us of the nutrients we need for our brands to develop and function fully, and (3) our current diets aren’t just lacking in what we need – they also actively contain chemicals that seem to act on our brains almost like drugs. (p198-201)</p></li>
<li><p>[Healthier countries] are leaving out the crap that’s making us sick in the first place. They’re all leaving out the refined carbohydrates, the processed food, the junk oils. That’s the key. That’s the magic bullet – just go back to whole foods. (p202)</p></li>
<li><p>There is growing evidence that pollution is seriously damaging our ability to focus. (p204)</p></li>
</ul>
</section>
<section id="ch13-the-rise-of-adhd-and-how-we-are-responding-to-it" class="level4">
<h4 class="anchored" data-anchor-id="ch13-the-rise-of-adhd-and-how-we-are-responding-to-it">Ch13: The Rise of ADHD and How We Are Responding to It</h4>
<ul>
<li>[to be added]</li>
</ul>
</section>
<section id="ch14-the-confinement-of-our-children-both-physically-and-psychologically" class="level4">
<h4 class="anchored" data-anchor-id="ch14-the-confinement-of-our-children-both-physically-and-psychologically">Ch14: The Confinement of Our Children, Both Physically and Psychologically</h4>
<ul>
<li>[to be added]</li>
</ul>
</section>
<section id="ch00-conclusion-attention-rebellion" class="level4">
<h4 class="anchored" data-anchor-id="ch00-conclusion-attention-rebellion">Ch00: Conclusion – Attention Rebellion</h4>
<ul>
<li>If this was a self-help book, I would be able to serve up a delightfully simple conclusion to this story. … But this is not a self-help book, and what I have to say to you is more complex, and it means starting with an admission: I have not entirely solved this problem in myself. (p267)</li>
<li>I made six big changes in my life: (1) I used pre-commitment to stop switching tasks so much. (2) I have changed the way I respond to my own sense of distraction. I ask: what could you do now to get into a flow state, and access your mind’s own ability to focus deeply? (3) I now take six months of the year totally off social media. (4) I realized that letting your mind wander is not a crumbling of attention, but in fact a crucial form of attention in its own right. (5) I used to see sleep as a luxury, or worst as an enemy. Now I am strict with myself about getting eight hours every night. (6) I try to give as much of my time to my god-children as free play as I can. (p268-270)</li>
<li>Your individual efforts to improve your attention can be dwarfed by an environment full of things that wreck it. (p271)</li>
<li>If we continue to be a society of people who are severely under-slept and overworked; who switch tasks every three minutes; who are tracked and monitored by social-media sites designed to figure out our weaknesses and manipulate them to make us scroll and scroll and scroll; who are so stressed that we become hypervigilant; who eat diets that cause our energy to spike and crash; who are breathing in a chemical soup of brain-inflaming toxins every day – then, yes, we will continue to be a society with serious attention problems. (p272-273)</li>
<li>Your focus needs certain things to be present: play for children and flow states for adults, to read books, to discover meaningful activities that you want to focus on, to have space to let your mind wander so you can make sense of your life, to exercise, to sleep properly, to eat nutritious food that makes it possible for you to develop a healthy brain, and to have a sense of safety. (p273)</li>
<li>We are living in an economic machine that requires greater speed to keep going – and that inevitably degrades our attention over time. (p279)</li>
<li>Most people don’t want a fast life – they want a good life (p279)</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.danyavorsky\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>